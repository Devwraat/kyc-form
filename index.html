<!DOCTYPE html>
<html>
<head>
  <title>P2P Buyer Form</title>
</head>
<body>
  <h2>P2P Buyer Data Collection</h2>
<form id="buyerForm">
  <input name="name" required />
  <input name="phone" required />
  <input name="aadhaar" required />
  <input name="pan" required />
  <!-- We will fetch location + IP automatically -->
  <button type="submit">Submit</button>
</form>

  <p id="msg"></p>

 <script>
  document.getElementById("buyerForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const form = e.target;

    const name = form.name.value;
    const phone = form.phone.value;
    const aadhaar = form.aadhaar.value;
    const pan = form.pan.value;

    // Get IP
    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    const ip = ipData.ip;

    // Get location
    let location = "Unknown";
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        position => {
          location = `${position.coords.latitude}, ${position.coords.longitude}`;
          submitToServer();
        },
        error => {
          location = "Location Denied";
          submitToServer();
        }
      );
    } else {
      submitToServer(); // Location not supported
    }

    async function submitToServer() {
      const payload = { name, phone, aadhaar, pan, ip, location };

      const res = await fetch("https://script.google.com/macros/s/AKfycbyq7sS4rpRCnbu59SbqCcmcXm58fjQvgbMawBrLrh_LrAq5lLNGvhGNyST423Wz6anv3A/exec", {
        method: "POST",
        body: JSON.stringify(payload),
        headers: {
          "Content-Type": "application/json"
        }
      });

      const result = await res.text();
      alert("Data submitted: " + result);
    }
  });
</script>

</body>
</html>

